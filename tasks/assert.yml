---
# =============================================================================
# Ansible Role: OS Customize - Assertions
# =============================================================================
# This file contains assertions to validate all role variables before execution.
# These checks ensure that the provided variable values are of the correct type
# and within valid ranges/options, preventing runtime errors.
#
# Flow:
# 1. General Settings validation
# 2. Timezone Configuration validation
# 3. Additional Packages validation
# 4. Welcome Message and Banner validation
# 5. Bashrc Configuration validation
# 6. MOTD News Configuration validation
# 7. SSH User Group Configuration validation
# =============================================================================

# -----------------------------------------------------------------------------
# 1. General Settings
# -----------------------------------------------------------------------------
- name: OS_Customize | assert | Validate system admin email
  assert:
    that:
      - os_customize_system_admin_mail is defined
      - os_customize_system_admin_mail is string
      - os_customize_system_admin_mail | length > 0
    quiet: true
    fail_msg: "os_customize_system_admin_mail must be a non-empty string (e-mail address)"

# -----------------------------------------------------------------------------
# 2. Timezone Configuration
# -----------------------------------------------------------------------------
- name: OS_Customize | assert | Validate timezone configuration flag
  assert:
    that:
      - os_customize_configure_timezone is defined
      - os_customize_configure_timezone in [true, false]
    quiet: true
    fail_msg: "os_customize_configure_timezone must be a boolean (true/false)"

- name: OS_Customize | assert | Validate timezone value
  assert:
    that:
      - os_customize_timezone is defined
      - os_customize_timezone is string
      - os_customize_timezone | length > 0
    quiet: true
    fail_msg: "os_customize_timezone must be a non-empty string (e.g., 'Europe/Warsaw')"

# -----------------------------------------------------------------------------
# 3. Additional Packages
# -----------------------------------------------------------------------------
- name: OS_Customize | assert | Validate additional packages flag
  assert:
    that:
      - os_customize_configure_additional_packages is defined
      - os_customize_configure_additional_packages in [true, false]
    quiet: true
    fail_msg: "os_customize_configure_additional_packages must be a boolean (true/false)"

- name: OS_Customize | assert | Validate additional packages list
  assert:
    that:
      - os_customize_additional_packages is defined
      - os_customize_additional_packages is iterable
    quiet: true
    fail_msg: "os_customize_additional_packages must be a list of package names"

# -----------------------------------------------------------------------------
# 4. Welcome Message and Banner
# -----------------------------------------------------------------------------
- name: OS_Customize | assert | Validate welcome message flag
  assert:
    that:
      - os_customize_configure_welcome_message is defined
      - os_customize_configure_welcome_message in [true, false]
    quiet: true
    fail_msg: "os_customize_configure_welcome_message must be a boolean (true/false)"

# -----------------------------------------------------------------------------
# 5. Bashrc Configuration
# -----------------------------------------------------------------------------
- name: OS_Customize | assert | Validate bashrc configuration flag
  assert:
    that:
      - os_customize_configure_bashrc is defined
      - os_customize_configure_bashrc in [true, false]
    quiet: true
    fail_msg: "os_customize_configure_bashrc must be a boolean (true/false)"

# -----------------------------------------------------------------------------
# 6. MOTD News Configuration
# -----------------------------------------------------------------------------
- name: OS_Customize | assert | Validate MOTD news flag
  assert:
    that:
      - os_customize_disable_motd_news is defined
      - os_customize_disable_motd_news in [true, false]
    quiet: true
    fail_msg: "os_customize_disable_motd_news must be a boolean (true/false)"

# -----------------------------------------------------------------------------
# 7. SSH User Group Configuration
# -----------------------------------------------------------------------------
- name: OS_Customize | assert | Validate SSH group flag
  assert:
    that:
      - os_customize_configure_ssh_group is defined
      - os_customize_configure_ssh_group in [true, false]
    quiet: true
    fail_msg: "os_customize_configure_ssh_group must be a boolean (true/false)"

- name: OS_Customize | assert | Validate SSH group name
  assert:
    that:
      - os_customize_ssh_group_name is defined
      - os_customize_ssh_group_name is string
      - os_customize_ssh_group_name | length > 0
    quiet: true
    fail_msg: "os_customize_ssh_group_name must be a non-empty string (e.g., 'sshusers')"

- name: OS_Customize | assert | Validate SSH group GID
  assert:
    that:
      - os_customize_ssh_group_gid is defined
      - os_customize_ssh_group_gid is number
      - os_customize_ssh_group_gid >= 1000
      - os_customize_ssh_group_gid <= 65534
    quiet: true
    fail_msg: "os_customize_ssh_group_gid must be a number between 1000 and 65534"
